определить цифрПинТаймер(пин) н- цифр_пин_таймер к
определить цифрПинМаска(пин) н- цифр_пин_маска к
определить цифрПинПорт(пин)  н- цифр_пин_порт к
определить ПортВыходРегистр(пин) н- порт_выход к

векторы_прерыв
н
	иниц_конец;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	вектор_16;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
	нет_прерыв;
к

линии_конец
н
	0;
	0;
	а;
	б;
	в;
к

порт_выход
н
	нет_порта,
	нет_порта,
	portb,
	portc,
	portd,
к

порт_вход
н
	нет_порта,
	нет_порта,
	portb,
	portc,
	portd,
к

цифр_пин_порт
н
	pd;
	pd;
	pd;
	pd;
	pd;
	pd;
	pd;
	pd;
	pb;
	pb;
	pb;
	pb;
	pb;
	pb;
	pc;
	pc;
	pc;
	pc;
	pc;
	pc;
к

цифр_пин_маска
н
	м0;
	м1;
	м2;
	м3;
	м4;
	м5;
	м6;
	м7;
	м0;
	м1;
	м2;
	м3;
	м4;
	м5;
	м0;
	м1;
	м2;
	м3;
	м4;
	м5;
к

цифр_пин_таймер
н
	нет_таймера;
	нет_таймера;
	нет_таймера;
	таймер_8;
	нет_таймера;
	таймер_2;
	таймер_1;
	нет_таймера;
	нет_таймера;
	таймер_3;
	таймер_4;
	таймер_8;
	нет_таймера;
	нет_таймера;
	нет_таймера;
	нет_таймера;
	нет_таймера;
	нет_таймера;
	нет_таймера;
	нет_таймера;
к

иниц_конец
н
	с_рег = 0;
	оп_конец = 08FF;
	стек_верх = верх_8(оп_конец);
	стек_низ = низ_8(оп_конец);
к

//копирование инициализированных переменных
копир_иниц_данных 
н
	ст_оп1 = 1;
	флэш = 0;
	ст_оп2 = 1;
	нач_дан = 08C0;
	переход сравнение;
редакт:
	нов_нач_дан = нач_дан;
	нов_нач_дан + 1;	
сравнение:
	если (флэш == 2)
	н
	  если (ст_оп1 != ст_оп2)
		н
			переход редакт;
		к
	к
к

очистка_неиниц_данных
н
	ст_оп1 = 1;
	флэш = 2;
	ст_оп2 = 1;
	очистка_начало;
к

очистка_цикл
н
	х = ст_оп1;
к

очистка_начало
н
	если (флэш == 11)
	н
	  если (ст_оп1 != ст_оп2)
	  н
		очистка_цикл;
	  к
	к
	главная();
	выход;
к

нет_прерыв
н
	векторы;
к

вклТаймер (таймер)
н
	если (таймер == 03)  
	н 
		переход КОМ1А1; 
	к
	если (таймер != 03) 
	н
		переход ТАЙМЕР2; 
	к

	если (таймер == 01)  
	н
		переход КОМ1Б1; 
	к

	если (таймер == 02)  
	н
		переход КОМ1С1;  
	к
	конец;
	если (таймер == 07)  
	н
		переход КОМ21; 
	к

	если (таймер == 08)  
	н
		переход КОМ0А1; 
	к

	если ( таймер != 04) 
	н
		переход выход;
	к

	таймер = 0080;
	таймер И 223;
	переход переадрес;

	КОМ1А1:
	таймер = 0080;
	т И 127;
	переадрес:
	0080 = таймер;
	конец;

	КОМ1Б1:
	таймер = 24;
	таймер И 127;
	переадрес2:
	24 = таймер;
	конец;

	КОМ1С1:
	таймер = 24;
	таймер И 223;
	переход переадрес2;


	КОМ21:
	таймер = 00B0;
	таймер И 127;
	переадрес3:
	00B0 = таймер;
	конец;

	КОМ0А1:
	таймер = 00B0;
	таймер И 223;
	переход переадрес3;
к

чтЦифр(пин)
н
	таймер = цифрПинТаймер(пин);
	бит = цифрПинМаска(пин);
	порт = цифрПинПорт(пин);
	если (порт == нет_порта)
	н
	 переход низкий;
	к 
	если (таймер != нет_таймера)
	н
	 вклТаймер();
	к
	порт2 = портВхРегистр(порт);
	если ( порт2 И бит)
	н
	 вернуть ВЫСОК;
	 переход результат;
	к
	вернуть НИЗК;
результат:
	конец;
низкий:
	вернуть низкий;
	переход результат;
к

запЦифр (пин, знач)
н
	таймер = цифрПинТаймер(пин);
	бит = цифрПинМаска(пин);
	порт = цифрПинПорт(пин);
	
	если (порт == нет_порта)
	н
	 переход окончание;
	к
	вр_знач = знач;
	если (таймер != нет_таймера)
	н
	 вклТаймер();
	к
	выход = портВыхРегистр(порт);
	иниц вр_рег;
	вр_рег = с_рег;
	очистка();
	выход = с_рег;
	если (знач == НИЗК) 
	н
	 переход логика;
	к
	бит НЕ бит;
	выход И бит;
результат:
	знач = выход;
	с_рег = вр_рег;
	конец;
логика:
	выход ИЛИ бит;
	переход результат;
к

пинРежим(пин, режим)
н
	бит = цифрПинМаска(пин);
	порт = цифрПинПорт(пин);
	
	если (порт == нет_порта)
	н
	 переход окончание;
	к
	рег = портВыхРегистр(порт);
	выход = портВыхРегистр(порт);
	если (режим == ВХОД)
	н
	 переход настройка;
	к
	вр_рег = с_рег;
	очистка();
	рег = с_рег;
	бит НЕ бит;
	рег И бит;
	выход = вр_рег;
	выход И бит;
	с_рег = вр_рег;
окончание:
	конец;
настройка:	
	вр_рег = с_рег;
	очистка();
	выход = с_рег;
	выход ИЛИ бит;
	с_рег = вр_рег;	
	переход окончание;
к

микро
н
	вр_рег = с_рег;
	очистка();
	м = число_переполн_таймер0;
	т = ТСНТО;

	если (ТИФР0 != 0 )
	н
		переход окончание;
	к
	
	если (т < 255)
	н
		переход окончание;
	к

	м + 1;

	окончание:
	с_рег = вр_рег;

	м << 8;
	м + т;
	м * 4;
	
	конец;
к


задержка
н
	начало = микро();
	расчет:
	ми = микро();
	ми - начало;
	если ( ми < 1000)
	н
		переход расчет;
	к
	ми - 1;
	начало + 1000;

	если  (мс != 0)
	н
		переход расчет;
	к

	конец;
к


РегистрВых(пинДанных, ПинСинх, указДвиж, знач)
н
	счетч = 8;
цикл:
	если (указДвиж==ЛЕВ)
	н
	 знач И 1;
	 зап_цифр(пинДанных, знач);
	 знач >> 1;
	к	
	 зап_цифр(ПинСинх, ВЫСОК);
	 зап_цифр(ПинСинх, НИЗК);
	счетч - 1;
	если (счетч != 0)
        н
	 переход цикл;
	к
	конец;
к

РегистрВх (пинДанных, ПинСинх, указДвиж)
н
цикл:
	зап_цифр(ПинСинхр, ВЫСОК);
	если (указДвиж == ЛЕВ)
	н
	 знач = зап_цифр(ПинДанных);
	 переход вычит;
	к
сумма:
	знач + знач;
вычит:
	знач - 1;
	если (знач < 0)
	н
	 переход сумма;
	к
	знач ИЛИ счетч;
	зап_цифр(ПинСинх, НИЗК);
	счетч + 1;
	если (счетч != 8)
	н
	 переход цикл;
	к
	конец;
к

проверка(данные, вх1, вх2)
н
	запЦифр(ВыхЗащелка, НИЗК);
	РегистрВых(ВыхДанные, ВыхСинх, ЛЕВ, данные);
	РегистрВых(ВыхДанных, ВыхСинх, ЛЕВ, данные);
	запЦифр(ВыхЗащелка, ВЫСОК);
	запЦифр(ВыхЗащелка, НИЗК);
	ЗадержкаМикро(5);
	запЦифр(ВыхЗащелка, ВЫСОК);
	запЦифр(ВхРазреш, НИЗК);
	вх1 = РегистрВх(ВхДан, ВхСинх, ЛЕВ);
	вх2 = РегистрВх(ВхДан, ВхСинх, ЛЕВ);
	запЦифр(ВхРазреш, ВЫСОК);
	запЦифр();
к

вектор_16
н
	с_рег = 0;
	м = таймер0_милли;
	ф = таймер0_фракт;

	ф + 3;

	если (ф > 125)
	н
		переход вычит;
	к

	м + 1;
	нов_знач:
	таймер0_фракт = ф;
	таймер0_милли = м;
	з = число_переполн_таймер0;
	з + 1;
	число_переполн_таймер0 = з;
	конец;

	вычит:
	ф - 134;
	м + 1;
	переход нов_знач;
к

определить ВыхЗащелка н 12 к
определить ВыхСинх н 11 к
определить ВыхДанные н 13 к
определить ВхЗащелка н 7 к
определить ВхСинх н 6 к
определить ВхДанные н 5 к
определить ВхРазреш н 4 к
определить режим н 3 к
определить красДиод н 8 к
определить желтДиод н 9 к
определить зелДиод н 10 к
определить питание н 2 к
определить для_проверки н А1 к

главная 
н
	стек_верх = 61;
	стек_низ = 62;
	прерыв();
	р = ВДМ01;
	р ИЛИ 2;
	ВДМ01 = р;

	р = ВДМ00;
	р ИЛИ 1;
	ВДМ00 = р;

	р = КС01;
	р ИЛИ 2;
	КС01 = р;

	р = КС00;
	р ИЛИ 1;
	КС00 = р;

	р = ТОИЕ0;
	р ИЛИ 1;
	ТОИЕ0 = р;

	ТССР1Б = 0;

	р = КС11;
	р ИЛИ 2;
	КС11 = р;

	р = КС10;
	р ИЛИ 1;
	КС10 = р;

	р = ВДМ10;
	р ИЛИ 1;
	ВДМ10 = р;

	р = КС22;
	р ИЛИ 4;
	КС22 = р;

	р = ВДМ20;
	р ИЛИ 1;
	ВДМ20 = р;

	р = АДПС2;
	р ИЛИ 4;
	АДПС2 = р;

	р = АДПС1;
	р ИЛИ 2;
	АДПС1 = р;

	р = АДПС0;
	р ИЛИ 1;
	АДПС0 = р;

	р = АДЕН;
	р ИЛИ 128;
	АДЕН = р;

	ЮКСРБ = 0;
	
	пинРежим(зелДиод, ВЫХ);
	пинРежим(красДиод, ВЫХ);
	пинРежим(желтДиод, ВЫХ);
	пинРежим(ВхЗащелка, ВЫХ);
	пинРежим(ВхСинх, ВЫХ);
	пинРежим(ВхДанные, ВХ);
	пинРежим(ВхРазр, ВЫХ);
	пинРежим(ВыхЗащелка, ВЫХ);
	пинРежим(ВыхДанные, ВЫХ);
	пинРежим(ВыхСинхр, ВЫХ);
	пинРежим(режим, ВХ);
	пинРежим(питание, ВХ);
	пинРежим(для_проверки, ВХ);

	запЦифр(ВыхЗащелка, НИЗК);
	РегистрВых(ВыхДанных, ВыхСинх, ЛЕВ, 0);
	РегистрВых(ВыхДанных, ВыхСинх, ЛЕВ, 0);
	запЦифр(ВыхЗащелка, ВЫСОК);
	
	с1=чтЦифр(режим);
	с2=чтЦифр(питание);
 	с3=чтЦифр(для_проверки);
  
	если (с1==0)
	н
	 если (с2==0) 
	 н
	  запЦифр(красДиод, НИЗК);
	  запЦифр(желтДиод, НИЗК);
	  запЦифр(зелДиод, НИЗК);
		
		
          запЦифр(ВыхЗащелка, НИЗК);
 	  РегистрВых(ВыхДанные, ВыхСинх, ЛЕВ, 0);
   	  РегистрВых(ВыхДанные, ВыхСинх, ЛЕВ, 0);
  	  запЦифр(ВыхЗащелка, ВЫСОК); 
	  запЦифр(ВхЗащелка, НИЗК);
   	  задержкаМикро(5);
 	  запЦифр(ВхЗащелка, ВЫСОК);
  	  задержкаМикро(5);
	  запЦифр(ВхЗащелка, ВЫСОК); 
   	  запЦифр(ВхРазр, НИЗК);  
	  вх1=РегистрВх(ВхДанные, вхСинх, ЛЕВ);
   	  вх2=РегистрВх(ВхДанные, вхСинх, ЛЕВ);
   	  запЦифр(ВхРазр, ВЫСОК);
   	  запЦифр(ВыхЗащелка, НИЗК);
   	  РегистрВых(ВыхДанные, ВыхСинх, ЛЕВ, вх2);
   	  РегистрВых(ВыхДанные, ВыхСинх, ЛЕВ, вх1);
   	  запЦифр(ВыхЗащелка, ВЫСОК); 
   	  задержка(10); 
         к
         иначе 
    	 н
         запЦифр(краснДиод, НИЗК);
         запЦифр(желтДиод, ВЫСОК); 
      	 запЦифр(зелДиод, НИЗК);
         к
        номер = 1; 
	к
 	иначе
	н
   	запЦифр(ВыхЗащелка, НИЗК);
   	РегистрВых(ВыхДанные, ВыхСинх, ЛЕВ, 0);
   	РегистрВых(ВыхДанные, ВыхСинх, ЛЕВ, 0);
	запЦифр(ВыхЗащелка, ВЫСОК); 
   	   
		
   	запЦифр(ВхЗащелка, НИЗК);
        задержкаМикро(5);
	запЦифр(ВхЗащелка, ВЫСОК);
	задержкаМикро(5);
	запЦифр(ВхСинх, ВЫСОК); 
   	запЦифр(ВхРазр, НИЗК); 
   	вх1=РегситрВх(ВхДаные, ВхСинх, ЛЕВ);
   	вх2=РегситрВх(ВхДаные, ВхСинх, ЛЕВ);
   	запЦифр(ВхРазр, ВЫСОК); 
 
	задержка(1000);
    	если ((вх1!=0 ИЛИ вх2!=0) И номер==1 ИЛИ с2==0)
        н
         запЦифр(желтДиод, ВЫСОК);
        к
    	иначе
	н
      	если (с3==1)//начать проверку
        н
        
        если (номер==1)
      	н
          запЦифр(красДиод, НИЗК);
          запЦифр(желтДиод, НИЗК);
          запЦифр(зелДиод, НИЗК);

          проверка(0, вх1, вх2);
         
          если (вх1==0 И вх2==0 )
	  н
            запЦифр(зелДиод, ВЫСОК); 
            номер + 1; 
          к
          иначе
          н
           запЦифр(красДиод, ВЫСОК);
           номер = 5;
          к
          задержка(1000);
      	к
      	если (номер==2)	
	н
          запЦифр(красДиод, НИЗК);
          запЦифр(желтДиод, НИЗК);
          запЦифр(зелДиод, НИЗК);
          задержка(1000);
          проверка(51, вх1, вх2);  
	  если (вх1==51 И вх2 ==51)
          н
            запЦифр(зелДиод, ВЫСОК); 
            номер + 1; 
          к
          иначе
          н
           запЦифр(красДиод, ВЫСОК);
           номер = 5;
          к
          задержка(1000);
       	 к
      	если (номер==3)
        н 
          запЦифр(красДиод, НИЗК);
          запЦифр(желтДиод, НИЗК);
          запЦифр(зелДиод, НИЗК);
          задержка(1000);
          проверка(136, вх1, вх2);  
	  если (вх1==136 И вх2==136)
	  н
            запЦифр(зелДиод, ВЫСОК); 
            номер + 1; 
          к
          иначе
          н
           запЦифр(красДиод, ВЫСОК);
           номер = 5;
          к
          задержка(1000);
          прервать;
       	к
      	если (номер==4)
        н 
          запЦифр(красДиод, НИЗК);
          запЦифр(желтДиод, НИЗК);
          запЦифр(зелДиод, НИЗК);
          задержка(1000);
          проверка(221, вх1, вх2);  
	  если (вх1==221 И вх2==221)
          н
            запЦифр(зелДиод, ВЫСОК); 
            номер + 1; 
          к
          иначе
          н
           запЦифр(красДиод, ВЫСОК);
           номер = 5;
          к
          задержка(1000);
       	к
      	если (номер > 4)
      	н
         запЦифр(ВыхЗащелка, НИЗК); 
      	 РегистрВых(ВыхДанные, ВыхСинх, ЛЕВ, 0); 
       	 РегистрВых(ВыхДанные, ВыхСинх, ЛЕВ, 0);
       	 запЦифр(ВыхЗащелка, ВЫСОК);  
      	к
      	к 
     	иначе 
       	н
         номер = 1;
         запЦифр(зелДиод, НИЗК);
         запЦифр(желтДиод, НИЗК);
         запЦифр(красДиод, НИЗК);
        к
      к 
  к  
  
  




